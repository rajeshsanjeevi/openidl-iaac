#!groovy
import groovy.json.JsonOutput
import groovy.json.JsonSlurper
node {
    def url =
    checkout()
    awsUploadCode()
    k8sUploadCode()
    buildInfrastructure()
}
def checkout() {
    stage('Clone') {
        git credentialsId: 'github', branch: "${params.GITHUB_BRANCH}", url: 'https://github.com/rajeshsanjeevi/openidl-iaac.git'
    }
}

def awsUploadCode() {
    sh '''
        cp ./aws/carrier.tfvars ./aws/aws_resources/carrier.auto.tfvars
        tar -czf aws-content.tar.gz -C aws/aws_resources --exclude .git .
        ls -l ./aws/aws_resources/carrier.auto.tfvars
    '''
 }
def k8sUploadCode() {
    sh '''
        cp ./aws/carrier.tfvars ./aws/k8s_resources/carrier.auto.tfvars
        tar -czf k8s-content.tar.gz -C aws/k8s_resources --exclude .git .
        ls -l ./aws/k8s_resources/carrier.auto.tfvars
    '''
 }

def buildInfrastructure() {
    stage('Terraform init') {}
    stage('Terraform plan') {}
    stage('Terraform apply') {}
}
